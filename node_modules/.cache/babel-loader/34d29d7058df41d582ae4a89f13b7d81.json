{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Admin\\\\Documents\\\\reactlinelogin\\\\src\\\\App.js\";\nimport React, { Component } from 'react';\nimport Home from './components/Home';\nimport ProductDetail from './components/ProductDetail';\nimport './App.css';\nimport { BrowserRouter as Router, Route, Link } from 'react-router-dom';\n\nclass App extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      userID: '',\n      name: '',\n      currentUser: null,\n      picture: ''\n    };\n  }\n\n  componentDidMount() {\n    console.log(sessionStorage.getItem(\"lastname\"));\n    let search = window.location.search;\n    let params = new URLSearchParams(search);\n    let code = params.get('code');\n    console.log(code);\n\n    if (code != undefined && code != null && sessionStorage.getItem(\"userID\") == null) {\n      var request = require('request');\n\n      var options = {\n        'method': 'POST',\n        'url': 'https://api.line.me/oauth2/v2.1/token',\n        'headers': {\n          'Content-Type': 'application/x-www-form-urlencoded'\n        },\n        form: {\n          'grant_type': 'authorization_code',\n          'code': code,\n          'redirect_uri': 'http://localhost:3000/lineAPI',\n          'client_id': '1654986755',\n          'client_secret': 'bdc92e6f36cc32f1f48f91c0d1ca2f45'\n        }\n      };\n      request(options, function (error, response) {\n        if (error) throw new Error(error);\n        let data = JSON.parse(response.body);\n        console.log(data.id_token);\n        var options2 = {\n          'method': 'POST',\n          'url': 'https://api.line.me/oauth2/v2.1/verify',\n          'headers': {\n            'Content-Type': 'application/x-www-form-urlencoded'\n          },\n          form: {\n            'id_token': data.id_token,\n            'client_id': '1654986755'\n          }\n        };\n        request(options2, function (error, response2) {\n          if (error) throw new Error(error);\n          let data2 = JSON.parse(response2.body);\n          console.log(data2);\n\n          if (data2.error == 'invalid_request') {\n            console.log(this.state.currentUser);\n\n            if (sessionStorage.getItem(\"userID\") == null) {\n              // location.href = \"https://access.line.me/oauth2/v2.1/authorize?response_type=code&client_id=1654986755&redirect_uri=http://localhost:3000/lineAPI&state=12345abcde&scope=profile%20openid&nonce=09876xyz\";\n              window.location.href = \"https://access.line.me/oauth2/v2.1/authorize?response_type=code&client_id=1654986755&redirect_uri=http://localhost:3000/lineAPI&state=12345abcde&scope=profile%20openid&nonce=09876xyz\";\n            }\n          } else {\n            this.setState({\n              currentUser: true\n            });\n            sessionStorage.setItem(\"userID\", data2.aud);\n            sessionStorage.setItem(\"username\", data2.name);\n            sessionStorage.setItem(\"picture\", data2.picture);\n            var options3 = {\n              'method': 'POST',\n              'url': 'http://localhost/LoginPHP/index.php?method=save',\n              'headers': {\n                'Content-Type': 'application/x-www-form-urlencoded'\n              },\n              form: {\n                'user_id': data2.aud,\n                'username': data2.name,\n                'picture': data2.picture\n              }\n            };\n            console.log(options3);\n            request(options3, function (error, response3) {\n              if (error) throw new Error(error); // let data3 = JSON.parse(response3);\n\n              console.log(response3.body);\n            });\n          }\n        }.bind(this));\n      }.bind(this));\n    }\n  }\n\n  render() {\n    // console.log(this.state.currentUser);\n    if (sessionStorage.getItem(\"userID\") == null) {\n      return /*#__PURE__*/React.createElement(Router, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 112,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 115,\n          columnNumber: 9\n        }\n      }, \"Loin Line\"));\n    } else {\n      return /*#__PURE__*/React.createElement(Router, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 123,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 126,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(Route, {\n        exact: true,\n        path: \"/lineAPI\",\n        component: Home,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 128,\n          columnNumber: 11\n        }\n      }), /*#__PURE__*/React.createElement(Route, {\n        path: \"/Product\",\n        component: ProductDetail,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 129,\n          columnNumber: 11\n        }\n      })));\n    }\n  }\n\n}\n\nexport default App;","map":{"version":3,"sources":["C:/Users/Admin/Documents/reactlinelogin/src/App.js"],"names":["React","Component","Home","ProductDetail","BrowserRouter","Router","Route","Link","App","constructor","props","state","userID","name","currentUser","picture","componentDidMount","console","log","sessionStorage","getItem","search","window","location","params","URLSearchParams","code","get","undefined","request","require","options","form","error","response","Error","data","JSON","parse","body","id_token","options2","response2","data2","href","setState","setItem","aud","options3","response3","bind","render"],"mappings":"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","sourcesContent":["import React, { Component } from 'react'\n\nimport Home from './components/Home'\nimport ProductDetail from './components/ProductDetail'\nimport './App.css'\nimport { BrowserRouter as Router, Route, Link } from 'react-router-dom';\nclass App extends Component {\n  constructor(props) {\n    super(props)\n\n    this.state = {\n      userID: '',\n      name: '',\n      currentUser: null,\n      picture: ''\n    }\n\n  }\n  componentDidMount(){\n    console.log(sessionStorage.getItem(\"lastname\"));\n \n    let search = window.location.search;\n    let params = new URLSearchParams(search);\n    let code = params.get('code');\n    \n       console.log(code);\n       if(code != undefined  && code != null && sessionStorage.getItem(\"userID\") == null){\n        var request = require('request');\n        var options = {\n          'method': 'POST',\n          'url': 'https://api.line.me/oauth2/v2.1/token',\n          'headers': {\n            'Content-Type': 'application/x-www-form-urlencoded'\n          },\n          form: {\n            'grant_type': 'authorization_code',\n            'code':code,\n            'redirect_uri': 'http://localhost:3000/lineAPI',\n            'client_id': '1654986755',\n            'client_secret': 'bdc92e6f36cc32f1f48f91c0d1ca2f45'\n          }\n        };\n        request(options, function (error, response) {\n          if (error) throw new Error(error);\n    \n          let data = JSON.parse(response.body);\n          console.log(data.id_token);\n        var options2 = {\n            'method': 'POST',\n            'url': 'https://api.line.me/oauth2/v2.1/verify',\n            'headers': {\n              'Content-Type': 'application/x-www-form-urlencoded'\n            },\n            form: {\n              'id_token': data.id_token,\n              'client_id': '1654986755'\n            }\n          };\n          request(options2, function (error, response2) {\n            if (error) throw new Error(error);\n     \n            let data2 = JSON.parse(response2.body);\n            console.log(data2);\n            if(data2.error == 'invalid_request'){\n              console.log(this.state.currentUser);\n              if(sessionStorage.getItem(\"userID\") == null){\n                // location.href = \"https://access.line.me/oauth2/v2.1/authorize?response_type=code&client_id=1654986755&redirect_uri=http://localhost:3000/lineAPI&state=12345abcde&scope=profile%20openid&nonce=09876xyz\";\n                 window.location.href = \"https://access.line.me/oauth2/v2.1/authorize?response_type=code&client_id=1654986755&redirect_uri=http://localhost:3000/lineAPI&state=12345abcde&scope=profile%20openid&nonce=09876xyz\";\n             \n              }\n          \n            }else{\n              this.setState({\n                currentUser: true\n              })\n              sessionStorage.setItem(\"userID\", data2.aud);\n              sessionStorage.setItem(\"username\",data2.name);\n              sessionStorage.setItem(\"picture\", data2.picture);\n                 var options3 = {\n                    'method': 'POST',\n                    'url': 'http://localhost/LoginPHP/index.php?method=save',\n                    'headers': {\n                      'Content-Type': 'application/x-www-form-urlencoded'\n                    },\n                    form:  { 'user_id': data2.aud,\n                    'username': data2.name,\n                    'picture':data2.picture\n                  }\n                  };\n              \n                  console.log(options3);\n                  request(options3, function (error, response3) {\n                    if (error) throw new Error(error);\n             \n                    // let data3 = JSON.parse(response3);\n                    console.log(response3.body);\n                \n                  });\n            }\n          }.bind(this));\n        }.bind(this));\n        \n     \n       }\n  }\n\n  render() {\n  \n    // console.log(this.state.currentUser);\n    if(sessionStorage.getItem(\"userID\") == null){\n      return(\n        <Router>\n        {/* Router component can have only 1 child. We'll use a simple\n          div element for this example. */}\n        <div>\n\n          Loin Line\n        </div>\n      </Router>\n      )\n    }else{\n      return(\n        <Router>\n        {/* Router component can have only 1 child. We'll use a simple\n          div element for this example. */}\n        <div>\n\n          <Route exact path=\"/lineAPI\" component={Home} />\n          <Route path=\"/Product\" component={ProductDetail} />\n        </div>\n      </Router>\n      )\n    }\n  \n  }\n\n}\n\nexport default App\n"]},"metadata":{},"sourceType":"module"}